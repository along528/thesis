\section{Event Selection}
\label{sec:event_selection}

%rewrite?
The expected number of signal events in the data is expected
to be very small compared to the background. %give a number
Fortunately, the three lepton signature of the signal allows us to
quickly throw out many events which do not look like the signal.
Still, this signature is not so unique that the background
is small enough to reveal the signal. 
Thus, we must devise a clever way to discriminate 
between the signal and these backgrounds. We select
events in two stages: first we start
by selecting events which have the general signature of the signal, 
this is referred to as the pre-selection stage; we then 
use more stringent cuts to discriminate between the signal and backgrounds, 
referred to as our signal region selection.
The signal region selection is determined by performing an 
optimization procedure starting from the pre-selection stage 
that minimizes the uncertainty
on the final measurement.  This is described in \sec\ref{sec:signal_yield}.
The signal region selection is further divided into different
categories that are each used in the final measurement
and which allows us to specially treat the different backgrounds
in each category.  
The selections used are described in more detail below.




\subsection{Pre-selection}
\label{sec:preselection}

The pre-selection is a broad selection which throws
away backgrounds that do not at all resemble the signal process.
It is mainly characterized by requiring the presence of exactly three leptons
(electron or muon) following the requirements listed in 
\sec\ref{sec:object_selection}, each with a $\pt$ of at least $20~\GeV$.
In addition, the events are required to be of good quality. This means
that the events were collected under good conditions during data taking,
both from the LHC operation and ATLAS detector operation. For instance,
during the 2012 data collection, the LAr component of the EM calorimeter
was known to occasionally produce artificial bursts of noise. These instances
were tracked and events where this occurred were thrown away. The event is 
also required to have a primary vertex with at least three associated tracks.
Finally, the event is required to pass the single lepton trigger
requirements listed in \sec\ref{sec:subsection_data} where 
at least one of the three leptons selected must have caused the trigger to fire.



\subsection{Signal Region Selection}
\label{sec:signal_regions}
The signal regions used in this analysis are separated based on the number of 
Same-Flavor Opposite-Sign (SFOS) lepton pairs selected in the event.  That is to say,
the number of lepton pair combinations in the event 
which could feasibly come from the leptonic decay of a $Z$-boson.
This results in three separate signal regions listed 
below with the lepton charge combinations
that fall in each category:
\begin{itemize}
\item \textbf{0 SFOS}: $e^{\pm}e^{\pm}\mu^{\mp}$, 
$\mu^{\pm}\mu^{\pm}e^{\mp}$ ($e^{\pm}e^{\pm}\mu^{\pm}$, 
$\mu^{\pm}\mu^{\pm}e^{\pm}$, $e^{\pm}e^{\pm}e^{\pm}$, $\mu^{\pm}\mu^{\pm}\mu^{\pm}$)
\item \textbf{1 SFOS}: $e^{\pm}e^{\mp}\mu^{\pm}$, 
$e^{\pm}e^{\mp}\mu^{\mp}$, $\mu^{\pm}\mu^{\mp}e^{\pm}$, $\mu^{\pm}\mu^{\mp}e^{\mp}$
\item \textbf{2 SFOS}: $e^{\pm}e^{\pm}e^{\mp}$, $\mu^{\pm}\mu^{\pm}\mu^{\mp}$
\end{itemize}
Note that in the 2 SFOS region, one lepton is allowed to belong to both 
pair combinations.
Those combinations listed in parentheses are not allowed for the signal based on charge conservation (neglecting charge mis-identification).  
The amount of the $W^{\pm}W^{\mp}W^{\pm}$ signal
which falls into each category is purely combinatoric.  
From the above list one can thus see that there are twice as many ways 
for the signal combinations (again neglecting those in parentheses)
to fall in the 1 SFOS regions as 
there to fall in either the 0 SFOS or 2 SFOS regions. 
Absent possible differences in signal efficiencies based on the leptons in each 
signal region, one should expect branching 
fractions of 25\%, 50\% and 25\% for the 0, 1, and 2 SFOS signal regions, respectively.


\begin{table}[ht!]
\centering
\begin{small}
\input{tables/optimized_signal_selection.tex}
\end{small}
\caption{Optimized signal selection split by number of Same-Flavor 
Opposite-Sign (SFOS) lepton pairs.}
\label{tab:signal_selection}
\end{table}

Each signal region has a unique selection determined by an optmizization
procedure that minimizes the uncertainty on the expected SM measurement. 
This optimization procedure is described in detail in \sec\ref{sec:signal_yield}.
The final selection determined from the optimization
is presented in \tab\ref{tab:signal_selection}.






%other metrics like what?


%I would like to show some plots demonstrating the effect of the optimization
%One way is that I could just show all of the different points evaluated
%with their uncertainty and signal like I have shown before. 
%It might be nice to as well overlay some isoforms for different
%constant selections which could give a nice idea of the effect of diff. selections.
%But perhaps there are even better ways to visualize the effect of a 
%multi-dimensional optimization function


%It should be said that a more algorithmic way of choosing the type 
%of quantities to consider could improve this selection. Deep learning...





%this description probably belongs in an earlier section
The magnitude and direction
of the missing $E_{T}$ may be interpreted as coming from the 
vector sum of the neutrinos.  By arguments of 
symmetry, one could then compare the azimuthal direction 
of the missing $E_{T}$ to the azimuthal direction of the vector
sum of the three charged leptons. When doing so, one finds that 
in the transverse plane, 
the direction of the three charged leptons
tends to be back-to-back with the direction of the 
three neutrinos (missing $E_{T}$). The
backgrounds also show this behavior, but it is less pronounced than 
it is for the signal.  As a result, 
there is some discriminating power when cutting on the difference 
in the two angles: 
$|\Delta\phi(3l,\MET)| = |\phi(3l)-\phi(\MET)|$. 
The behavior of this quantity for signal and
background is similar in all three signal regions so based on the 
optimization it was chosen to apply the cut
$|\Delta\phi(3l,\MET)| > 2.5$ everywhere.  
We also considered taking the difference in angle between
the missing $E_{T}$ and individual leptons (e.g. the highest $\pt$ lepton) 
but this was shown to be not nearly as effective.  

Finally, the distribution of the invariant mass
from same-flavor lepton pairs (regardless of sign) 
was considered in the 0 SFOS 
region to remove any low-mass contamination from processes like from QCD.  
This was shown to offer some
modest discriminating power and a threshold of $m_{SF} > 20$~GeV 
was chosen only for the 0 SFOS region.

\subsection{Fiducial Region Selection}
\label{sec:fiducial}

A fiducial phase space or fiducial region is the 
region the analysis is sensitive to, defined 
using purely truth information (generator information before
being passed through ATLAS reconstruction).
We define our fiducial region
based on the optimized signal selection (defined at the reconstruction level)
but using only truth information. For instance, the reconstructed
lepton \pt~ requirement of 
$\pt^{\textrm{Reco}} > 20~\GeV$
is taken into account in the fiducial region selection
by requiring 
$\pt^{\textrm{Truth}} > 20~\GeV$.
By applying this for all cuts in the reconstruction selection
shown earlier in \tab\ref{tab:signal_selection},
one may compare the predicted signal yields after reconstruction
using this selection to the one in the fiducial region selection
using just truth information. Any differences are then attributed solely
to effects from reconstruction. 
The fiducial selections are determined at truth level 
using Rivet~\cite{Buckley:2010ar}, which allows for 
comparisons between different generators.


\begin{table}[ht!]
\centering
\begin{small}
\input{tables/fiducial_selection.tex}
\end{small}
\caption{Fiducial regions based on optimized selection.}
\label{tab:fiducial_selection}
\end{table}

The chosen fiducial region selection 
is listed in \tab\ref{tab:fiducial_selection}.
Only prompt leptons (those not originating from hadron decays) are used for 
lepton selections, and these leptons are dressed with prompt photons 
within a cone with $\Delta R = 0.1$. Generator-level jets are 
reconstructed by running the anti-kt algorithm with radius 
parameter $\Delta R = 0.4$ on all final-state particles 
after the parton showering and hadronization with the exception of prompt 
leptons, prompt photons, and neutrinos. The \MET~variable is calculated 
using all generator-level neutrinos. 
As can be seen, the selection 
in \tab\ref{tab:fiducial_selection} looks very similar to that in 
\tab\ref{tab:signal_selection} except for the object definitions
using truth information and that 
events are removed if $\tau$ leptons are present from the $W$ decays.  
Thus, the fiducial selection
does not include the branching fraction to $W\rightarrow\tau\nu$ decay, 
even though there will be some contamination from this process in the final 
reconstruction level selection. 



The fiducial cross-sections are evaluated in both 
the \vbfnlo~and \madgraph~samples mentioned in Section~\ref{sec:signal}.
The predicted fiducial cross-sections at each stage of the selection
are listed for both generators in \tab\ref{}.
The fiducial cross-sections and their
statistical uncertainties 
are summarized in each channel for both generators 
after the entire fiducial selection
in \tab\ref{tab:fiducial_cross_sections}.
They are seen to be in good agreement between both generators.


The derived fiducial cross-sections using the two generators are 
shown in Table~\ref{tab:fiducial_cross_sections}.  The cross-sections are observed
to be in good agreement between the two generators. The MadGraph NLO
fiducial cross-sections are used in the final measurement.
The PDF and scale uncertainties on the fiducial cross-sections
are determined after summing over all three signal regions 
as described earlier in \sec\ref{sec:signal}.
% it would probably be a good idea to include the fiducial cut-flows as well.





\begin{table}[ht!]
\centering
\begin{footnotesize}
\input{tables/fiducial_cross_sections.tex}
\end{footnotesize}
\caption{Fiducial cross-sections derived in each signal region for the two 
generators. Production modes are summed together to get one fiducial 
cross-section per channel per generator. The cross-sections are seen to 
be in good agreement between the two generators.}
\label{tab:fiducial_cross_sections}
\end{table}
